pipeline
{
	agent any 
	environment
	{
		DOCKERHUB_CREDENTIALS =credentials('dockerhubID')
		IMAGE_NAME="josh57/new-rep"
	}
	
	stages
	{
		stage('Checkout')
		{
			steps
			{
				git(
				    	url: 'git@github.com:joshua-mnz/New_Rep.git',
					branch: 'main'
				)
			}
		}
		stage('Build Docker Image')
		{
			steps
			{
				script
				{
					dockerImage=docker.build("${IMAGE_NAME}:latest")
				}
			}
		}
		stage('Push to DockerHub')
		{
			steps
			{
				script
				{
					docker.withRegistry('https://registry.hub.docker.com',dockerhubID')
					{
						dockerImage.push()
					}
				}
			}
		}
		post
		{
			success
			{
				echo 'Pipeline succeeded!'
			}
			failure
			{
				echo 'Pipeline failed'
			}
			always
			{
				echo 'Cleaning up Workspace'
				deleteDir()
			}
		}
	}
}
